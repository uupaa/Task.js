var c=this.self||global;function e(a,d,b){b=b||{};var k=b.b||null,l=b.buffer||[];this.c=(b.prefix||"anonymous")+"@"+ ++f;this.a={b:k,buffer:l,d:d,g:a,e:0,h:0,f:0,message:"",state:""};g[this.c]=this;!a&&h(this,"init")}
function h(a,d){var b=a.a;if(""===b.state){switch(d){case "init":b.state=j(b);break;case "pass":++b.h;b.state=j(b);break;case "miss":++b.f;b.state=j(b);break;case "exit":b.state="exit"}if(b.state){if(b.d instanceof e)b.d[b.state]();else b.d("pass"===b.state?null:Error(b.message),a.a.buffer,a);delete g[a.c];a.a.b=null;a.a.buffer=null;a.a.d=null}}return a}function j(a){return a.f>a.e?"miss":a.f+a.h>=a.g?"pass":""}var m="process"in c,g={},f=0;e.repository="https://github.com/uupaa/Task.js/";e.name="Task";
e.dump=function(a){var d={},b;for(b in g)if(!a||a===b.split("@")[0])d[b]=g[b].a;return JSON.parse(JSON.stringify(d))};e.drop=function(){g={};f=0};
e.prototype={constructor:e,buffer:function(){return this.a.buffer},push:function(a){this.a.buffer&&this.a.buffer.push(a);return this},set:function(a,d){this.a.buffer&&(this.a.buffer[a]=d);return this},pass:function(){this.a.b&&this.a.b(this.c);return h(this,"pass")},miss:function(){this.a.b&&this.a.b(this.c);return h(this,"miss")},exit:function(){return h(this,"exit")},extend:function(a){this.a.g+=a;return this},message:function(a){this.a.message=a;return this},missable:function(a){this.a.e+=a;return this},
isFinished:function(){return""!==this.a.state}};e.flatten=function(a){return Array.prototype.concat.apply([],a)};e.arraynize=function(a){return Array.prototype.slice.call(a)};e.objectize=function(a){return Object.keys(a).reduce(function(d,b){d[b]=a[b];return d},{})};m&&(module.exports=e);c.Task?c.Task_=e:c.Task=e;
