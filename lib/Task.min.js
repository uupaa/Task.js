var c=this.self||global;function f(a,d,b){b=b||{};var e=d instanceof f,l=b.tick||null,m=b.name||"anonymous";b=b.buffer||(e?d.buffer():[]);this.c=m+"@"+ ++g;this.a={b:l,buffer:b,g:d,i:e,f:a,d:0,h:0,e:0,message:"",state:""};h[this.c]=this;!a&&j(this,"init")}
function j(a,d){var b=a.a;if(""===b.state){switch(d){case "init":b.state=k(b);break;case "pass":++b.h;b.state=k(b);break;case "miss":++b.e;b.state=k(b);break;case "exit":b.state="exit"}if(b.state){if(b.i)b.g[b.state]();else b.g("pass"===b.state?null:Error(b.message),a.a.buffer,a);delete h[a.c];a.a.b=null;a.a.buffer=null;a.a.g=null}}return a}function k(a){return a.e>a.d?"miss":a.e+a.h>=a.f?"pass":""}var n="process"in c,h={},g=0;f.repository="https://github.com/uupaa/Task.js/";f.name="Task";
f.prototype={constructor:f,push:function(a){this.a.buffer&&this.a.buffer.push(a);return this},set:function(a,d){this.a.buffer&&(this.a.buffer[a]=d);return this},pass:function(){this.a.b&&this.a.b(this.c);return j(this,"pass")},miss:function(){this.a.b&&this.a.b(this.c);return j(this,"miss")},exit:function(){return j(this,"exit")},buffer:function(){return this.a.buffer},extend:function(a){this.a.f+=a;return this},message:function(a){this.a.message=a;return this},missable:function(a){this.a.d+=a;return this},
isFinished:function(){return""!==this.a.state}};f.dump=function(a){var d={},b;for(b in h)if(!a||a===b.split("@")[0]){var e=h[b].a;d[b]={junction:e.i,taskCount:e.f,missableCount:e.d,passedCount:e.h,missedCount:e.e,state:e.state}}return JSON.parse(JSON.stringify(d))};f.drop=function(){h={};g=0};f.flatten=function(a){return Array.prototype.concat.apply([],a)};f.arraynize=function(a){return Array.prototype.slice.call(a)};
f.objectize=function(a){return Object.keys(a).reduce(function(d,b){d[b]=a[b];return d},{})};n&&(module.exports=f);c.Task?c.Task_=f:c.Task=f;
