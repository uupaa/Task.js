var c=this.self||global;function e(a,d,b,l){var h=d instanceof e?d:null;this.a={i:d,e:(b||"anonymous")+"_"+ ++f,h:a,d:l,f:0,j:"",k:0,g:0,state:"",b:h,c:h?h.payload():[]};g[this.a.e]=this;j(this,"init")}
function j(a,d){var b=a.a;if(""===b.state){switch(d){case "init":b.state=k(b);break;case "pass":++b.k;b.state=k(b);break;case "miss":++b.g;b.state=k(b);break;case "exit":b.state="exit"}if(b.state){if(b.b)b.b[b.state]();else b.i("pass"===b.state?null:Error(b.j),a.payload(),a);delete g[b.e];a.a.c=[];a.a.b=null;a.a.i=null;a.a.d=null}}return a}function k(a){return a.g>a.f?"miss":a.g+a.k>=a.h?"pass":""}var m="process"in c,g={},f=0;e.name="Task";e.repository="https://github.com/uupaa/Task.js/";
e.prototype={constructor:e,set:function(a,d){""===this.a.state&&(this.a.b?this.a.b.set(a,d):this.a.c[a]=d);return this},push:function(a){""===this.a.state&&(this.a.b?this.a.b.push(a):this.a.c.push(a));return this},clear:function(){this.a.b?(this.a.b.clear(),this.a.c=this.a.b.payload()):this.a.c=[];return this},payload:function(){return this.a.b?this.a.b.payload():this.a.c||[]},pass:function(){this.a.d&&this.a.d(this.a.e);return j(this,"pass")},miss:function(){this.a.d&&this.a.d(this.a.e);return j(this,
"miss")},exit:function(){return j(this,"exit")},extend:function(a){this.a.h+=a;return this},message:function(a){this.a.j=a+"";return this},missable:function(a){this.a.f+=a;return this},isFinished:function(){return""!==this.a.state}};e.dump=function(a){var d={},b;for(b in g)if(!a||a===b.split("_")[0])d[b]=g[b].a;return JSON.parse(JSON.stringify(d))};e.reset=function(){g={};f=0};e.flatten=function(a){return Array.prototype.concat.apply([],a)};m&&(module.exports=e);c.Task?c.Task_=e:c.Task=e;
