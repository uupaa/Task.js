var c=this.self||global;function e(b,d,a){a=a||{};var k=a.prefix||"anonymous",m=a.buffer||new f;a=a.j||null;this.c=k+"@"+ ++g;this.a={buffer:m,d:d,g:b,b:a,e:0,h:"",i:0,f:0,state:""};h[this.c]=this;j(this,"init")}
function j(b,d){var a=b.a;if(""===a.state){switch(d){case "init":a.state=l(a);break;case "pass":++a.i;a.state=l(a);break;case "miss":++a.f;a.state=l(a);break;case "exit":a.state="exit"}if(a.state){if(a.d instanceof e)a.d[a.state]();else a.d("pass"===a.state?null:Error(a.h),b.a.buffer,b);delete h[b.c];b.a.buffer=null;b.a.d=null;b.a.b=null}}return b}function l(b){return b.f>b.e?"miss":b.f+b.i>=b.g?"pass":""}var f=c.MappedArray||require("uupaa.mappedarray.js"),n="process"in c,h={},g=0;e.repository="https://github.com/uupaa/Task.js/";
e.name="Task";e.dump=function(b){var d={},a;for(a in h)if(!b||b===a.split("@")[0])d[a]=h[a].a;return JSON.parse(JSON.stringify(d))};e.drop=function(){h={};g=0};
e.prototype={constructor:e,buffer:function(){return this.a.buffer},push:function(b){this.a.buffer&&this.a.buffer.push(b);return this},set:function(b,d){this.a.buffer&&this.a.buffer.set(b,d);return this},pass:function(){this.a.b&&this.a.b(this.c);return j(this,"pass")},miss:function(){this.a.b&&this.a.b(this.c);return j(this,"miss")},exit:function(){return j(this,"exit")},extend:function(b){this.a.g+=b;return this},message:function(b){this.a.h=b+"";return this},missable:function(b){this.a.e+=b;return this},
isFinished:function(){return""!==this.a.state}};n&&(module.exports=e);c.Task?c.Task_=e:c.Task=e;
