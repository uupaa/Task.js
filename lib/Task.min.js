var e=this.self||global;function f(a,d,c,h){this.a={d:d,j:c||"",g:a,c:h,e:0,h:"",i:0,f:0,state:"",b:[]};c&&(g[c]=this);j(this,"init")}
function j(a,d,c,h,l){var b=a.a;if(""===b.state){void 0!==c&&(h?(b.b[h]=c,l||b.b.push(c)):b.b.push(c));switch(d){case "init":b.state=k(b);break;case "pass":++b.i;b.state=k(b);break;case "miss":++b.f;b.state=k(b);break;case "exit":b.state="exit"}if(b.state){if(b.d instanceof f)b.d[b.state](b.b);else b.d("pass"===b.state?null:Error(b.h),b.b);b.j&&delete g[b.j];b.b=[];b.d=b.c=null}}return a}function k(a){return a.f>a.e?"miss":a.f+a.i>=a.g?"pass":""}var m="process"in e,g={};f.name="Task";
f.repository="https://github.com/uupaa/Task.js/";f.dump=function(a){var d=[];if(a)d.push(JSON.stringify(g[a].a,null,4));else for(var c in g)d.push(JSON.stringify(g[c].a,null,4));return d+""};f.clear=function(){g={}};f.flatten=function(a){return Array.prototype.concat.apply([],a)};
f.prototype={constructor:f,isFinished:function(){return""!==this.a.state},extend:function(a){this.a.g+=a;return this},missable:function(a){this.a.e+=a;return this},message:function(a){this.a.h=a+"";return this},pass:function(a,d,c){this.a.c&&this.a.c();return j(this,"pass",a,d,c)},miss:function(a,d,c){this.a.c&&this.a.c();return j(this,"miss",a,d,c)},exit:function(a,d,c){return j(this,"exit",a,d,c)}};m&&(module.exports=f);e.Task?e.Task_=f:e.Task=f;
